/*

 jslog  - v1.0 - 2/Feb/2012
 Copyright (C) 2012 by Abhishek Dev
 MIT License @ http://bit.ly/abhishekdevMIT-License
*/
var jslog=function(d){var c=function(b,a){var f=d.extend(c.defaults,a);this.counter=0;this.config=f;this.setLogLevel(this.getOfflineState("_log_level")||b);this.ui=new c.UI(this)};c.defaults={name:"JSLOG",persistState:true,normalizeDomain:true,onLog:null,noCSSFile:false,isFormattedLogText:true,pipeConsole:true};c.levels={NONE:-1,ERROR:1,WARN:2,INFO:3,DEBUG:4};c.prototype.setLogLevel=function(b){b=""+b.toUpperCase();c.levels[b]?(this.level=b,this.setOfflineState("_log_level",b)):alert("JSLOG set with invalid level: "+
b+", setting level to NONE")};c.prototype.getLogLevel=function(){return this.level};c.prototype.isDebugEnabled=function(){return c.levels[this.getLogLevel()]>=c.levels.DEBUG};c.prototype.isInfoEnabled=function(){return c.levels[this.getLogLevel()]>=c.levels.INFO};c.prototype.isWarnEnabled=function(){return c.levels[this.getLogLevel()]>=c.levels.WARN};c.prototype.log=function(b,a){var f=c.levels[this.level]||-1,e,b=b.toUpperCase();e=c.levels[b]||0;if(e===0)b="DEBUG",e=c.levels.DEBUG;f>=e&&(++this.counter,
this.config.pipeConsole&&c.util.toConsole&&c.util.toConsole(b,a),this.ui.addLog(this,b,a),this.config.onLog&&this.config.onLog.call(this,b,a))};c.prototype.debug=function(b,a){this.log("DEBUG",b,a)};c.prototype.info=function(b,a){this.log("INFO",b,a)};c.prototype.warn=function(b,a){this.log("WARN",b,a)};c.prototype.error=function(b,a,f){this.log("ERROR",b+c.util.getErrorDetails(a),f)};c.prototype.clearLog=function(){this.counter=0;this.ui.clearLog()};if(window.clipboardData)c.prototype.toClipboard=
function(){window.clipboardData.setData("text",this.toString());alert("Logs copied to clipboard")};c.prototype.exportView=function(){var b=window.open("","jsLogger","width=750, height=400, location=0, resizable=1, menubar=1, scrollbars=1"),a;b&&(a=this.toString(),b.document.write("<pre>"+a+"</pre>"),b.focus())};c.prototype.setOfflineState=function(b,a){return this.config.persistState?c.util.setOfflineState(this.config.name+b,a):null};c.prototype.getOfflineState=function(b){return this.config.persistState?
c.util.getOfflineState(this.config.name+b):null};c.prototype.toString=function(){return this.ui.$log.text()};c.prototype.toArray=function(b){var a=this.toString().split("\r\n");a.pop();b===-1&&(a=a.reverse());return a};c.util={setOfflineState:function(){var b;return window.localStorage?function(a,b){localStorage.removeItem(a);localStorage[a]=b;return true}:function(a,b){var c=a+"="+escape(b);window.location.protocol.toUpperCase()=="HTTPS:"&&(c+="; secure");document.cookie=c;return null}}(),getOfflineState:function(){var b;
return window.localStorage?function(a){return localStorage[a]}:function(a){var b=a+"=",a=document.cookie,c=null,d;if(a.length>0&&(d=a.indexOf(b),d!=-1)){d+=b.length;b=a.indexOf(";",d);if(b==-1)b=a.length;c=unescape(a.substring(d,b))}return c}}(),getFormattedTime:function(){var b=new Date,a=b.getHours(),c=b.getMinutes(),e=b.getSeconds(),b=b.getMilliseconds(),a=""+a;a+=(c<10?":0":":")+c;a+=(e<10?":0":":")+e;a+=(b<10?",0":",")+b;return a},getErrorDetails:function(b){var a="";b!=null&&b!=""&&(a="\n -- Error Info --",
a+="\n name: "+b.name,a+="\n number: "+b.number,a+="\n message: "+b.message,a+="\n description: "+b.description);return a},toConsole:function(){function b(a,b){var c=a.toLowerCase(),c=console[c];typeof c=="function"?c(b):console.log(b)}return window.console?b:null}()};c.UI=function(b){b.config.noCSSFile&&d("#jslog_style").length&&d('<style id="jslog_style">.jslog{font-family:Tahoma,Helvetica,Arial;color:#002b36;font-size:9px;line-height:normal;letter-spacing:normal;position:fixed;_position:absolute;z-index:10000;top:20px;left:2px}.jslog select,.jslog input{font:99% Tahoma,Helvetica,Arial}.jslog .dontDisplay{display:none}.jslog .counter{cursor:pointer;position:absolute;background-color:#fdf6e3;border:1px solid #b58900;padding:2px;user-select:none;box-shadow:0 0 3px #aaa}.jslog .content{text-align:left;border:1px solid #b58900;width:400px;position:absolute;top:20px;left:0;background-color:white;box-shadow:0 0 3px #aaa}.jslog .header{padding:2px;border-bottom:1px solid #eee8d5;background-color:#fdf6e3;box-shadow:0 1px 2px #eee8d5;position:relative}.jslog .header label{color:#586e75;padding-right:3px;border-right:1px solid #bbb}.jslog .header input{cursor:pointer;color:#002b36;margin:0 1px}.jslog .header .clear{color:#268bd2;margin-left:3px}.jslog .header .close{color:#dc322f;font:monospace;cursor:pointer;display:block;height:16px;line-height:16px;overflow:hidden;position:absolute;right:1px;text-align:center;top:1px;vertical-align:middle;width:16px}.jslog .log{height:240px;overflow:auto;font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace;font-size:11px;margin:0;padding:0;list-style:none inside}.jslog .log li{word-wrap:break-word;border-bottom:1px solid #ccc}.jslog .log li.odd{background-color:#fff}.jslog .log li.even{background-color:#f6f6f6}.jslog .log li ins{padding:0 3px;float:left;font-weight:bold;text-decoration:none}.jslog .log li ins .noTextFormat{width:40px}.jslog .log li pre{display:none}.jslog .log li em{font-style:normal;padding:0 5px 0 3px;color:#6c71c4}.jslog .log li .DEBUG{background-color:blue;color:white}.jslog .log li .INFO{background-color:#10ff10;color:#073642}.jslog .log li .WARN{background-color:yellow;color:#586e75}.jslog .log li .ERROR{background-color:#dc322f;color:white}.jslog .footer{display:none;padding-left:2px;border-top:1px solid black;background-color:#fdf6e3}</style>').appendTo("head");
this.name=b.config.name;this.persistState=b.config.persistState;this.build(b)};c.UI.prototype.build=function(b){var a=this,c=a.name,c=d('<div id="'+c+'_container" class="jslog"><div id="'+c+'_handle" class="counter" title="JavaScript Log Count : Double-Click to toggle details.">0</div><div id="'+c+'_body" class="content dontDisplay"><div id="'+c+'_header" class="header"><label id="'+c+'_LogLevel" >Log Level : <select id="'+c+'_selectLogLevel" class="levelList"><option id="'+c+'_noneLevel" value="NONE" >None</option><option id="'+
c+'_errorLevel" value="ERROR" >ERROR</option><option id="'+c+'_warnLevel" value="WARN" >WARN</option><option id="'+c+'_infoLevel" value="INFO" >INFO</option><option id="'+c+'_debugLevel" value="DEBUG" >DEBUG</option></select></label><input type="button" id="'+c+'_clear" class="clear" value="Clear"/><input type="button" id="'+c+'_viewPlain" class="export" value="Export"/>'+(b.toClipboard?'<input type="button" id="'+c+'_copyToClipBoard" class="copyToClpBrd" value="Copy To Clipboard"/>':"")+'<span id="'+
c+'_closeBtn" class="close" title="Close">X</span></div><ol id="'+c+'_logDisplay" class="log"></ol><div id="'+c+'_footer" class="footer"></div></div></div>'),e=a.getOfflineState("_logui_visibility");a.$me=c;a.$counter=c.children(".counter");a.$content=c.children(".content");a.$log=a.$content.children(".log");a.$me.toggleClass("noTextFormat",!b.config.isFormattedLogText);a.$content.toggleClass("dontDisplay",e=="false").find(".levelList").val(b.level);d.fn.draggable&&a.$me.draggable({containment:"document",
handle:a.$counter}).css("position","");a.$counter.bind("dblclick",function(){a.toggle()});a.$content.delegate(".clear","click",function(){b.clearLog()}).delegate(".levelList","change",function(){b.setLogLevel(this.options[this.selectedIndex].value)}).delegate(".close","click",function(){a.close()}).delegate(".export","click",function(){b.exportView()}).delegate(".copyToClpBrd","click",function(){b.toClipboard&&b.toClipboard()});d(function(){a.$me.prependTo("body")})};c.UI.prototype.destroy=function(){};
c.UI.prototype.toggle=function(){this.$content.hasClass("dontDisplay")?this.open():this.close()};c.UI.prototype.open=function(){this.$content.removeClass("dontDisplay");this.setOfflineState("_logui_visibility",true)};c.UI.prototype.close=function(){this.$content.addClass("dontDisplay");this.setOfflineState("_logui_visibility",false)};c.UI.prototype.clearLog=function(){this.$counter.text(0);this.$log.empty()};c.UI.prototype.addLog=function(b,a,f){var e=c.util.getFormattedTime(),h=a,g="</div></li>";
b.config.isFormattedLogText&&(e+=Array(14-e.length).join("&nbsp;"),a+=Array(7-a.length).join("&nbsp;"),g="&#13;&#10;"+g);a=d("<li><ins>"+a+"</ins><em>"+e+"</em><span>"+f+'</span><div style="clear: both;">'+g);a.addClass((b.counter%2==0?"odd":"even")+" "+h);this.$counter.text(b.counter);this.$log.prepend(a)};c.UI.prototype.setOfflineState=function(b,a){return this.persistState?c.util.setOfflineState(this.name+b,a):null};c.UI.prototype.getOfflineState=function(b){return this.persistState?c.util.getOfflineState(this.name+
b):null};return function(){var b=window.javaScriptLoggerEnabled||d("html").data("jslog")||window.location.href.match(/enablejslog/),a=function(){};a.prototype={clearLog:a,debug:a,error:a,exportView:a,getLogLevel:a,getOfflineState:a,info:a,isDebugEnabled:a,isInfoEnabled:a,isWarnEnabled:a,log:a,setLogLevel:a,setOfflineState:a,toArray:a,toString:a,warn:a};return b===true?new c("DEBUG"):new a}()}(jQuery);
